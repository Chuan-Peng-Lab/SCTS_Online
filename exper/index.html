<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
    <title>社会认知词库量表</title>
    <!-- 实用工具 -->
    <script src='../assets/js/jquery-3.6.0.min.js'></script>
    <!-- 核心引用 -->
    <link href="jspsych.css" rel="stylesheet" type="text/css">
    <script src="jspsych.js"></script>
    <script src="../assets/jspsych/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="../assets/jspsych/plugins/jspsych-fullscreen.js"></script>
    <script src="../assets/jspsych/plugins/jspsych-instructions.js"></script>
    <script src="../assets/jspsych/plugins/jspsych-survey-likert.js"></script>
    <script src="../assets/jspsych/plugins/jspsych-survey-html-form.js"></script>
    <script src="../assets/jspsych/plugins/jspsych-html-button-response.js"></script>
    <script src="../assets/jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="../assets/jspsych/plugins/jspsych-call-function.js"></script>
    <!-- 本实验的js函数 -->
    <script src="index.js"></script>
    <!-- 这个word里面放的是单词，全部都在里面 -->
    <script src="word.js"></script>
    <script src="exp.js"></script>
</head>

<body style="text-align: center; background-color: grey; color: white;"></body>
<script>
    // 实验参数
    let exper_number = "S01";
    let word_block_num = 150; // 单个block的单词数量
    let word_first_day = 1050; // 第一天的单词数量
    let delay = 800; // 全部选择后 跳转延迟时间，单位为毫秒
    let blank = 500; // 每个trial之间的空白屏时间 单位 毫秒

    let dimension = ["能力", "道德", "社交能力", "外表", "社会经济地位"]; // 需要维度评分的维度

    // 以下非实验参数，最好不改
    let debug = false;
    let word_tmp; // 保存 当天需要的单词数量
    let timeline = []; // 定义空的时间线
    let info = {}; // 保存被试信息
    let variable = []; // 时间线变量
    let timeout = 0; // 记录 setTimeout

    if (jsPsych.data.getURLVariable("debug")) {
        debug = true;
        // 调试参数
        word_block_num = 5;
        word_first_day = 35;
        delay = 100;
        if (jsPsych.data.getURLVariable("auto")) {
            auto(); // 自动运行，方便调试
        }
    } // 这玩意，只是为了方便调试

// 第一步，填写实验编号
    jsPsych.init({
        timeline: [{
            // 实验编号填写
            type: "survey-html-form",
            preamble: "<p style =' color : white'>你分配到的实验编号是</p>",
            html: "<p><input name='Q0' type='text' value='" + exper_number + "' disabled='disabled' /></p><p><input name='Q1' type='number' value='' required/></p>",
            button_label: "继续",
            on_finish: function (data) {
                data.number = exper_number + data.response.Q1.padStart(4, "0");
                info["index"] = exper_number + data.response.Q1.padStart(4, "0");
            },
            on_load: function () {
                let bb = document.getElementById("jspsych-content");
                let label1 = document.createElement("p");
                label1.id = "numberf", label1.textContent = "你的最终编号是：" + document.getElementsByTagName("input")[0].value + document.getElementsByTagName("input")[1].value.toString().padStart(4, "0");
                label1.style = "font-size: 20px;color: white;";
                bb.appendChild(label1);
                document.getElementsByTagName("input")[1].addEventListener("input", function (a) {
                    document.getElementById("numberf").textContent = "你的最终编号是：" + document.getElementsByTagName("input")[0].value + document.getElementsByTagName("input")[1].value.toString().padStart(4, "0");
                })
            }
        }, {
            type:"survey-html-form",
            preamble:"<p style = 'color : white'>你的实验次数是</p>",
            html:"<p><input name='Q0' type='number' value=' ' required/></p>",
            button_label:"继续",
            on_finish: function (data) {
                info["NumberOfExperiments"] = data.response.Q0;
            }
        }],
        on_finish: function () {
            // 判断本地储存当中是否有 实验编号，如果有 且 day ！= 1，就代表第二天
            if(localStorage.getItem(info["index"]) &&  (jsPsych.data.getURLVariable("day") && jsPsych.data.getURLVariable("day") != 1)) { 
                info = JSON.parse(localStorage.getItem(info["index"]));
                word_tmp = info["WordSurplus"];
            } else { 
                // 否则就是第一天
                if(!jsPsych.data.getURLVariable("debug")) { 
                    // debug 不移除index，便于测试实验
                    localStorage.removeItem(info["index"]);
                } else if(localStorage.getItem(info["index"])) { 
                    // 是debug的话，并且 info存在，就调用
                    info = JSON.parse(localStorage.getItem(info["index"]));
                }
                let p = jsPsych.randomization.shuffle(getWord());
                word_tmp = p.splice(0, word_first_day);
                info["WordSurplus"] = p;
            }
            // 判断info是否完整
            if(Object.keys(info).length < 7) { 
                timeline.push(begin_introduction(), info_get());
            } else { 
                timeline.push(begin_introduction());
            }
            start();
        }
    });

</script>

</html>