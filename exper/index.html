<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="UTF=8">
        <title>ç¤¾ä¼šè®¤çŸ¥è¯åº“é‡è¡¨</title>
        <!-- å®ç”¨å·¥å…· -->
        <script src='../assets/js/jquery-3.6.0.min.js'></script>
        <!-- æ ¸å¿ƒå¼•ç”¨ -->
        <link href="../assets/jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
        <script src="../assets/jspsych/jspsych.js"></script>
        <script src="../assets/jspsych/plugins/jspsych-survey-multi-choice.js"></script>
        <script src="../assets/jspsych/plugins/jspsych-fullscreen.js"></script>
        <script src="../assets/jspsych/plugins/jspsych-instructions.js"></script>
        <script src="../assets/jspsych/plugins/jspsych-survey-likert.js"></script>
        <script src="../assets/jspsych/plugins/jspsych-survey-html-form.js"></script>
        <script src="../assets/jspsych/plugins/jspsych-html-button-response.js"></script>
        <script src="../assets/jspsych/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="../assets/jspsych/plugins/jspsych-call-function.js"></script>
        <!-- æœ¬å®éªŒçš„jså‡½æ•° -->
        <script src="index.js"></script>
        <script src="word.js"></script>
    </head>
    <body style="text-align: center; background-color: grey; color: white;"></body>
    <script>
        // è°ƒè¯•ç”¨
        localStorage.clear();

        // é—®é¢˜æ¢è®¨
        
        // 1å•è¯ -> 5ç»´åº¦
        // 2200 å•è¯ 
        // 1000ï¼Œ 5/6ä¸ªblock

        // 50 ä¸€å°å—
        // 1
        // 

        // 1 2
        // ã€å•è¯Aï¼Œ DAå‘¢ã€‘
        // 1 2
        // ã€Cã€Dã€‘
        //  1 2

        // å®éªŒå‚æ•°
        let exper_number = "S01";
        let word_block_num = 150; // å•ä¸ªblockçš„å•è¯æ•°é‡
        let word_first_day = 1000; // ç¬¬ä¸€å¤©çš„å•è¯æ•°é‡



        // let word_tmp = localStorage.getItem("WordSurplus") ? 
        //     localStorage.getItem("WordSurplus") : 
        //     jsPsych.randomization.sampleWithoutReplacement(wordAll, 1000);
        let debug = false
        if (jsPsych.data.getURLVariable("debug")) { 
            debug = true;
        } // è¿™ç©æ„ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿è°ƒè¯•

        let word_tmp; // ä¿å­˜ å½“å¤©éœ€è¦çš„å•è¯æ•°é‡

        if (!localStorage.getItem("WordSurplus")) { 
            // ç¬¬ä¸€å¤©çš„è¯
            localStorage.clear();
            let p = jsPsych.randomization.shuffle(getWord());
            word_tmp = p.splice(0, word_first_day);
            localStorage.setItem("WordSurplus", JSON.stringify(p));
        } else { 
            // ç¬¬äºŒå¤©
            word_tmp = JSON.parse(localStorage.getItem("WordSurplus"));
        }

        let timeline = []; // å®šä¹‰ç©ºçš„æ—¶é—´çº¿
        let info = {}; // ä¿å­˜è¢«è¯•ä¿¡æ¯

        // å®šä¹‰ å•è¯ é¡ºåº
        let variable = [];
        for (let i = 0; i < word_tmp.length; i++) { 
            variable.push({
                word: word_tmp[i],
                len: word_tmp[i].length
            })
        }
        variable = jsPsych.randomization.shuffle(variable);

// æœ€åˆéƒ¨åˆ† å®éªŒæŒ‡å¯¼è¯­
        if (!localStorage.getItem("info")) { 
            // å¦‚æœæ˜¯ç¬¬ä¸€å¤©ï¼Œæ‰¾ä¸åˆ°ä¿¡æ¯çš„è¯
            timeline.push(begin_introduction(), info_get());
        } else { 
            // å¦‚æœ è¢«è¯•ä¿¡æ¯å­˜åœ¨çš„è¯ï¼Œåˆ™ä½¿ç”¨å…ˆå‰çš„ä¿¡æ¯
            info = JSON.parse(localStorage.getItem("info"));
            timeline.push(begin_introduction());
        }

// ç¬¬ä¸€éƒ¨åˆ† ç»´åº¦è¯„åˆ† 1
        var scale = [1,2,3,4,5,6,7,8,9];
        let proc1 = {
            type: 'survey-likert',
            questions: [
              {prompt: "<strong>èƒ½åŠ›ğŸ‘‡</strong>", name: 'ability', labels: scale, required: true}, 
              {prompt: "<strong>é“å¾·ğŸ‘‡</strong>", name: 'morality', labels: scale, required: true},
              {prompt: "<strong>ç¤¾äº¤èƒ½åŠ›ğŸ‘‡</strong>", name: 'socialSkills', labels: scale, required: true},
              {prompt: "<strong>å¤–è¡¨ğŸ‘‡</strong>", name: 'appearance', labels: scale, required: true},
              {prompt: "<strong>ç¤¾ä¼šç»æµåœ°ä½ğŸ‘‡</strong>", name: 'socioeconomicStatus', labels: scale, required: true}
            ],
            preamble: function() {
                return '<p style="font-size: 30px;font-weight: 700;color: red;">' + jsPsych.timelineVariable("word", true) + '</p><p>è¯·è¡¨æ˜ä½ å¯¹è¯¥é™ˆè¿°çš„åŒæ„ç¨‹åº¦<br/>ï¼ˆ1 = éå¸¸ä¸åŒæ„ï¼Œ9 = éå¸¸åŒæ„ï¼‰</p>';
            },
            scale_width: 500,
            on_load: function() { 
                    // è®© æ ‡ç­¾ å·¦ç§»
                    let a = document.getElementsByClassName("jspsych-survey-likert-statement");
                    for (let i = 0; i < a.length; i++){ 
                        a[i].style.textAlign = "left";
                        a[i].style.paddingTop = "0px";
                    }
                    // éšè— continue æŒ‰é’®
                    document.getElementById("jspsych-survey-likert-next").style.visibility="hidden";

                    $("input[type=radio]").on("input", function(a){
                        // åˆ¤æ–­æ˜¯å¦å…¨éƒ¨é€‰æ‹©äº†
                        // å¦‚æœå…¨éƒ¨é€‰æ‹©äº†ï¼Œåˆ™å»¶è¿Ÿ1ç§’è·³è½¬
                        if($("input[name=Q0]:checked").length > 0 && 
                            $("input[name=Q1]:checked").length > 0 && 
                            $("input[name=Q2]:checked").length > 0 &&
                            $("input[name=Q3]:checked").length > 0 && 
                            $("input[name=Q4]:checked").length > 0){ 
                            setTimeout(function(){ 
                                $("#jspsych-survey-likert-next").click()
                            }, 1500);
                        }
                    })
                },
                on_finish: function(data) { 
                    // äº”ç»´åº¦è¯„åˆ†ç»“æœå‘ˆç°
                    data.ability = data.response.ability;
                    data.morality = data.response.morality;
                    data.socialSkills = data.response.socialSkills;
                    data.appearance = data.response.appearance;
                    data.socioeconomicStatus = data.response.socioeconomicStatus;
                    data.word = jsPsych.timelineVariable("word", true);
                },
                data: {
                    subIdx: info["index"],
                    NumberOfExperiments: info["NumberOfExperiments"],
                    Name: info["Name"],
                    Sex: info["Sex"],
                    Education: info["Education"],
                    BirthYear: info["BirthYear"],
                    save: true
                }
        };
        if(debug){ 
            timeline.push({
                timeline: [proc1],
                timeline_variables: variable.splice(0, 10)
            });
        } else { 
            timeline.push({
                timeline: [proc1],
                timeline_variables: variable.splice(0, (variable.length<word_block_num) ? variable.length : word_block_num)
            });
            while(variable.length>0) { 
                timeline.push({
                    timeline: [proc1, {
                        type: "html-keyboard-response",
                        stimulus: "ä¼‘æ¯ä¸€ä¸‹å§",
                        choices: jsPsych.ALL_KEYS
                    }],
                    timeline_variables: variable.splice(0, (variable.length<word_block_num) ? variable.length : word_block_num)
                });
            }
        }
 
// ç¬¬äºŒéƒ¨åˆ† æ•ˆåº¦æ‰“åˆ†
        let proc2 = {
            type: 'survey-multi-choice',
            questions: [
                {prompt: jsPsych.timelineVariable("word"), options: [1,2,3,4,5,6,7,8,9], required: true, horizontal: true}
            ],
            on_load: function() { 
                // å®šä¹‰å¤´éƒ¨æ–‡å­—æ ·å¼
                document.getElementsByClassName("survey-multi-choice")[0].style = "text-align: center; font-size: 25px;";

                // éšè— continue æŒ‰é’®
                document.getElementById("jspsych-survey-multi-choice-next").style.visibility="hidden";
                
                // åˆ›å»ºä¸‹æ–¹æç¤ºè¯­
                let p = document.createElement("p");
                p.innerHTML = "è¯·è¡¨æ˜ä½ å¯¹è¯¥å•è¯çš„ç§¯æ/æ¶ˆæç¨‹åº¦è¯„åˆ†<br/>ï¼ˆ1 = éå¸¸æ¶ˆæï¼Œ9 = éå¸¸ç§¯æï¼‰";
                p.style = "font-size: 30px; font-weight: normal;";
                document.getElementById("jspsych-content").appendChild(p);

                $("input[type=radio]").on("input", function(a){
                    // åˆ¤æ–­æ˜¯å¦å…¨éƒ¨é€‰æ‹©äº†
                    // å¦‚æœå…¨éƒ¨é€‰æ‹©äº†ï¼Œåˆ™å»¶è¿Ÿ1ç§’è·³è½¬
                    if($("input[type=radio]:checked").length > 0){ 
                        setTimeout(function(){
                            $("#jspsych-survey-multi-choice-next").click()
                        }, 1500);
                    }
                })
            },
            on_finish: function(data) { 
                // åˆ†å€¼çš„å‘ˆç°
                data.validity = data.response.Q0;
                data.word = jsPsych.timelineVariable("word", true);
            },
            data: {
                    subIdx: info["index"],
                    NumberOfExperiments: info["NumberOfExperiments"],
                    Name: info["Name"],
                    Sex: info["Sex"],
                    Education: info["Education"],
                    BirthYear: info["BirthYear"],
                    save: true
                }
        };
        // å®šä¹‰ä¸€ä¸‹ç¬¬äºŒä¸ªå•è¯block
        variable = [];
        for (let i = 0; i < word_tmp.length; i++) { 
            variable.push({
                word: word_tmp[i],
                len: word_tmp[i].length
            })
        }
        variable = jsPsych.randomization.shuffle(variable);

        if(debug){ 
            timeline.push({
                timeline: [proc2],
                timeline_variables: variable.splice(0, 10)
            });
        } else { 
            timeline.push({
                timeline: [proc2],
                timeline_variables: variable.splice(0, (variable.length<word_block_num) ? variable.length : word_block_num)
            });
            while(variable.length>0) { 
                timeline.push({
                    timeline: [proc2, {
                        type: "html-keyboard-response",
                        stimulus: "ä¼‘æ¯ä¸€ä¸‹å§",
                        choices: jsPsych.ALL_KEYS
                    }],
                    timeline_variables: variable.splice(0, (variable.length<word_block_num) ? variable.length : word_block_num)
                });
            }
        }

        jsPsych.init({
            timeline: timeline,
            on_finish: function() { 
                jsPsych.data.displayData();
            },
            
        });

// ç»´åº¦è¯„åˆ†ç¬¬äºŒç§ç±»å‹ï¼Œåˆ†å¼€å‘ˆç°
// // ç¬¬ä¸€éƒ¨åˆ† ç»´åº¦è¯„åˆ† 2
// let proc2 = {
//             type: 'survey-multi-choice',
//             questions: [
//                 {prompt: '[å•è¯A]ç”¨äºæè¿°ã€ã€‘ç»´åº¦', options: [1,2,3,4,5,6,7,8,9], required: true, horizontal: true}
//             ],
//             on_load: function() { 
//                 // å®šä¹‰å¤´éƒ¨æ–‡å­—æ ·å¼
//                 document.getElementsByClassName("survey-multi-choice")[0].style = "text-align: center; font-size: 25px;";

//                 // éšè— continue æŒ‰é’®
//                 document.getElementById("jspsych-survey-multi-choice-next").style.visibility="hidden";
                
//                 // åˆ›å»ºä¸‹æ–¹æç¤ºè¯­
//                 let p = document.createElement("p");
//                 p.innerHTML = "è¯·è¡¨æ˜ä½ å¯¹è¯¥é™ˆè¿°çš„åŒæ„ç¨‹åº¦<br/>ï¼ˆ1 = éå¸¸ä¸åŒæ„ï¼Œ9 = éå¸¸åŒæ„ï¼‰";
//                 p.style = "font-size: 30px; font-weight: normal;";
//                 document.getElementById("jspsych-content").appendChild(p);

//                 $("input[type=radio]").on("input", function(a){
//                     // åˆ¤æ–­æ˜¯å¦å…¨éƒ¨é€‰æ‹©äº†
//                     // å¦‚æœå…¨éƒ¨é€‰æ‹©äº†ï¼Œåˆ™å»¶è¿Ÿ1ç§’è·³è½¬
//                     if($("input[type=radio]:checked").length > 0){ 
//                         setTimeout(function(){
//                             $("#jspsych-survey-multi-choice-next").click()
//                         }, 1500);
//                     }
//                 })
//             },
//             on_finish: function(data) { 
//                 // åˆ†å€¼çš„å‘ˆç°
//                 data.recognition = data.response.Q0;
//             }
//         };
//         timeline.push(proc2);
    </script>
</html>